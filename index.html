<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="description" content="Ronin Logger - Track your Japanese immersion hours">
  <title>æµªäºº Logger</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="app">
    <!-- Header with Power Level & Streak -->
    <header class="header">
      <div class="power-level">
        <span class="power-label">FRONTIER</span>
        <span class="power-value" id="powerLevel">Lv 0</span>
      </div>
      <div class="streak-display">
        <span class="streak-fire">ðŸ”¥</span>
        <span class="streak-count" id="streakCount">0</span>
        <span class="streak-label">day streak</span>
      </div>
      <button class="settings-btn" id="settingsBtn" aria-label="Settings">âš™</button>
    </header>

    <!-- Weekly Ring -->
    <section class="ring-section">
      <div class="ring-container">
        <svg class="progress-ring" viewBox="0 0 200 200">
          <defs>
            <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#3b82f6" />
              <stop offset="100%" stop-color="#06b6d4" />
            </linearGradient>
            <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#fbbf24" />
              <stop offset="100%" stop-color="#f59e0b" />
            </linearGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="3" result="coloredBlur" />
              <feMerge>
                <feMergeNode in="coloredBlur" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>
          <circle class="ring-bg" cx="100" cy="100" r="85" />
          <circle class="ring-progress" id="ringProgress" cx="100" cy="100" r="85" />
        </svg>
        <div class="ring-inner">
          <div class="week-hours" id="weekHours">0h</div>
          <div class="week-label" id="weekGoalLabel">/ 21h this week</div>
        </div>
      </div>
      <div class="week-status" id="weekStatus">Week 52 â€¢ Resets Sunday</div>
    </section>

    <!-- Activity Heatmap (12 weeks) -->
    <section class="heatmap-section">
      <div class="heatmap-header">
        <span class="heatmap-label">Last 12 Weeks</span>
      </div>
      <div class="heatmap-container" id="heatmapContainer">
        <!-- Dynamically populated by JS -->
      </div>
      <div class="heatmap-legend">
        <span class="legend-label">Less</span>
        <span class="legend-cell" data-level="0"></span>
        <span class="legend-cell" data-level="1"></span>
        <span class="legend-cell" data-level="2"></span>
        <span class="legend-cell" data-level="3"></span>
        <span class="legend-cell" data-level="4"></span>
        <span class="legend-label">More</span>
      </div>
    </section>

    <!-- Mountain (Total Progress) -->
    <section class="mountain-section">
      <div class="mountain-header">
        <span class="mountain-label">THE MOUNTAIN</span>
        <span class="mountain-value" id="totalHours">0h / 3,000h</span>
      </div>
      <div class="mountain-bar">
        <div class="mountain-progress" id="mountainProgress"></div>
      </div>
      <div class="rank-display" id="rankDisplay">Rank F â€¢ Beginner</div>
    </section>

    <section class="input-section">
      <div class="preset-row">
        <button class="preset-btn" data-mins="24">24m<span class="preset-hint">anime</span></button>
        <button class="preset-btn" data-mins="24">24m<span class="preset-hint">manga</span></button>
        <button class="preset-btn" data-mins="45">45m<span class="preset-hint">podcast</span></button>
        <button class="preset-btn" data-mins="60">60m<span class="preset-hint">1 hour</span></button>
      </div>
      <div class="input-wrapper">
        <input type="number" id="minutesInput" class="minutes-input" placeholder="24" inputmode="numeric" min="1"
          max="999">
        <span class="input-suffix">mins</span>
      </div>
      <button class="claim-btn" id="claimBtn">
        <span class="claim-text">CLAIM</span>
        <span class="claim-icon">âš¡</span>
      </button>
    </section>

    <!-- Recent Log -->
    <section class="log-section" id="logSection">
      <div class="log-header">Recent Claims</div>
      <div class="log-list" id="logList"></div>
    </section>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="closeSettings">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- Account -->
        <div class="setting-group compact">
          <div class="setting-label-row">
            <label>Account</label>
          </div>
          <div id="authSection">
            <div id="authLoggedOut" class="auth-grid">
              <input type="email" id="authEmail" placeholder="Email" class="compact-input">
              <input type="password" id="authPassword" placeholder="Password" class="compact-input">
              <div class="auth-buttons-row">
                <button class="auth-btn login" id="loginBtn">Login</button>
                <button class="auth-btn signup" id="signupBtn">Sign Up</button>
              </div>
            </div>
            <div id="authLoggedIn" style="display:none">
              <div class="user-info-row">
                <span id="authUserEmail" class="user-email">-</span>
                <button class="auth-btn logout" id="logoutBtn">Logout</button>
              </div>
            </div>
            <small class="status-msg" id="authStatus">Syncs across devices</small>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Goals & Adjustments -->
        <div class="setting-group compact">
          <div class="setting-label-row">
            <label>Goals & Adjust</label>
          </div>
          <div class="goals-grid">
            <div class="goal-item">
              <span class="sub-label">Weekly</span>
              <input type="number" id="weeklyGoal" placeholder="21" class="compact-input center">
            </div>
            <div class="goal-item">
              <span class="sub-label">Total</span>
              <input type="number" id="totalGoal" placeholder="3000" class="compact-input center">
            </div>
            <div class="goal-item">
              <span class="sub-label">Adjust</span>
              <div class="manual-add-row">
                <input type="number" id="manualTotal" placeholder="+h" class="compact-input center">
                <button class="icon-btn" id="saveManualTotal">ðŸ’¾</button>
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Presets -->
        <div class="setting-group compact">
          <div class="setting-label-row">
            <label>Quick Presets (min)</label>
          </div>
          <div class="presets-grid">
            <div class="preset-edit-item">
              <span class="sub-label">anime</span>
              <input type="number" id="preset1" value="24" class="compact-input center">
            </div>
            <div class="preset-edit-item">
              <span class="sub-label">manga</span>
              <input type="number" id="preset2" value="24" class="compact-input center">
            </div>
            <div class="preset-edit-item">
              <span class="sub-label">podcast</span>
              <input type="number" id="preset3" value="45" class="compact-input center">
            </div>
            <div class="preset-edit-item">
              <span class="sub-label">hour</span>
              <input type="number" id="preset4" value="60" class="compact-input center">
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Anki -->
        <div class="setting-group compact">
          <div class="setting-label-row">
            <label>Anki (Local)</label>
          </div>
          <div class="anki-row">
            <input type="text" id="ankiDeck" placeholder="Deck Name" class="compact-input">
            <input type="text" id="ankiField" placeholder="Field" class="compact-input" style="max-width: 80px;">
            <button class="icon-btn sync" id="syncAnkiBtn">ðŸ”„</button>
          </div>
          <div class="stats-row">
            <span class="stat-tag">Mature Cards: <span id="ankiWords">0</span></span>
            <!-- Hidden input to start logic, kept for compatibility -->
            <input type="hidden" id="ankiWordsInput">
          </div>
        </div>

      </div>

      <div class="modal-footer compact-footer">
        <button class="text-btn" id="exportBtn">Export JSON</button>
        <span class="sep">â€¢</span>
        <button class="text-btn" id="importBtn">Import JSON</button>
        <input type="file" id="importFile" accept=".json" style="display:none">
      </div>
    </div>
  </div>

  <audio id="claimSound" preload="auto">
    <source src="assets/claim.mp3" type="audio/mpeg">
  </audio>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <script src="app.js"></script>
</body>

</html>